local tj_max = 105
local heat_threshold = tj_max - 10

conky.config = {
    alignment = 'bottom_right',
    background = false,
    double_buffer = true,
    update_interval = 5,          -- Low CPU/battery usage
    use_xft = true,
    font = 'DejaVu Sans Mono:size=9',
    own_window = true,
    own_window_type = 'normal',     -- Changed from 'dock' to 'normal' for potential rounded corners fix
    own_window_transparent = true,
    own_window_argb_visual = true,
    own_window_argb_value = 0,    -- Fully transparent look
    own_window_hints = 'undecorated,sticky,skip_taskbar,skip_pager,below',
    default_color = '888888',
    minimum_width = 100,
    minimum_height = 100,
    gap_x = 25,
    gap_y = 25,
    draw_shades = false,
    draw_outline = false,
    draw_borders = false,
};

conky.text = [[
  CPU  ${color #A0BCAC}${cpu cpu0}%${color}
${if_match "${execi 5 sensors | grep 'Package id 0:' | awk '($4+0 > ]]..heat_threshold..[[){print "HIGH"}'}" == "HIGH"}${color red}⚠${color}${else} ${endif} Temp ${if_match "${execi 5 sensors | grep 'Package id 0:' | awk '($4+0 > ]]..heat_threshold..[[){print "HIGH"}'}" == "HIGH"}${color red}${execi 5 sensors | grep 'Package id 0:' | awk '{printf "%.0f", $4}' | tr -d '+'} / ]]..tj_max..[[°C${color}${else}${color #6074A1}${execi 5 sensors | grep 'Package id 0:' | awk '{printf "%.0f", $4}' | tr -d '+'} / ]]..tj_max..[[°C${color}${endif}
  RAM  ${color #FF8C00}${execi 10 free -m | awk 'NR==2{printf "%.1f / %.1f GiB", $3/1024, $2/1024}'}${color}
  SSD  ${color #A88F59}${execi 60 df -BG / | awk 'NR==2{used=$3; total=$2; gsub(/G/,"",used); gsub(/G/,"",total); print used " / " total " GiB"}'}${color}
  On   ${color #657B3F}${uptime}${color}
  ───────────────────
  ${if_match "${execi 5 sensors | grep 'Package id 0:' | awk '($4+0 > ]]..heat_threshold..[[){print "HIGH"}'}" == "HIGH"}${color red}Heat level critical${color}${else}• ComStar Node 7-1A${endif}
  ───────────────────
]];
